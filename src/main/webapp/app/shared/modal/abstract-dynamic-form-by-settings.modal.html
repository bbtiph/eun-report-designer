<div class="modal-header">
  <h4 class="modal-title text-center" id="modal-title"></h4>
  <button type="button" class="close" aria-describedby="modal-title" (click)="modal.dismiss()">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
<div class="modal-body">
  <div class="d-flex justify-content-center">
    <div class="col-8">
      <form *ngIf="filterForm" [formGroup]="filterForm" class="filter-form">
        <ng-container *ngTemplateOutlet="recursiveList; context:{ $implicit: filterFields,formGroup:filterForm }"> </ng-container>
      </form>
      <ng-template #recursiveList let-filterFields let-formGroup="formGroup">
        <div class="form-group">
          <ng-container *ngFor="let item of filterFields">
            <p *ngIf="item.children || item.type == 'list'" class="centered-content">{{item.name}}:</p>
            <ng-container *ngIf="item.children; else default;">
              <div class="row pb-4">
                <div [formGroup]="formGroup.get(item.index)">
                  <ng-container
                    *ngTemplateOutlet="recursiveList; context:{ $implicit: item.children, formGroup: formGroup.get( item.index)}"
                  >
                  </ng-container>
                </div>
              </div>
            </ng-container>
            <ng-template #default>
              <div *ngIf="item.type == 'list'">
                <table class="table table-bordered">
                  <thead>
                    <tr>
                      <th *ngFor="let column of item.columns; let columnIndex = index" class="text-center">
                        <p><b>{{column.title}}</b></p>
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let row of row[item.index]; let rowIndex = index">
                      <td *ngFor="let column of item.columns; let columnIndex = index" class="text-center">
                        <div *ngIf="action !== 'view'" class="input-group">
                          <input
                            class="form-control"
                            [(ngModel)]="row[column.index]"
                            [disabled]="column.disabled"
                            (ngModelChange)="updateListCellValue(rowIndex, columnIndex, $event, item)"
                          />
                        </div>
                        <h6 *ngIf="action === 'view'">{{ row[column.index] }}</h6>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <dl *ngIf="action === 'view' && item.type != 'list'" class="row-md jh-entity-details">
                <dt><span>{{item.name}}</span></dt>
                <dd>
                  <span>{{formGroup.get(item.index).value}}</span>
                </dd>
              </dl>
              <div *ngIf="action === 'edit' || action === 'create'" class="row mb-3">
                <label *ngIf="item.type != 'list'" class="form-label">{{item.name}}</label>
                <div class="input-group">
                  <input
                    class="form-control"
                    *ngIf="item.type != 'reference' && item.type != 'list'"
                    [type]="item.type"
                    [formControl]="formGroup.get(item.index)"
                    [placeholder]="item.name"
                    [name]="item.index"
                  />
                </div>
                <ng-select
                  *ngIf="item.type == 'reference' && item.source == 'countries' && !item.disabled"
                  [items]="countriesSharedCollection"
                  [bindLabel]="item.index"
                  [bindValue]="item.index"
                  placeholder="Select ..."
                  [formControl]="formGroup.get(item.index)"
                  (change)="onChangeCountry($event, item.relationField)"
                >
                </ng-select>
              </div>
            </ng-template>
          </ng-container>
        </div>
      </ng-template>
    </div>
  </div>
</div>
<div class="modal-footer">
  <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss()">Close</button>
  <button *ngIf="action === 'edit'" type="button" class="btn btn-success" (click)="modal.close({ row: convert() })">Edit</button>
  <button *ngIf="action === 'create'" type="button" class="btn btn-success" (click)="modal.close({ row: convert() })">Create</button>
</div>
