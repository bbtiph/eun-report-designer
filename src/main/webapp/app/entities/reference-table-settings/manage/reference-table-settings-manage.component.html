<div *ngIf="loader.isLoading$ | async" class="loading-container flex-content-center">
  <mat-progress-spinner color="primary" mode="indeterminate"></mat-progress-spinner>
</div>
<div *ngIf="!isFromReportBlock">
  <div class="d-flex justify-content-end">
    <ng-select [(ngModel)]="selectedRefTable" (change)="onRefTableSelect(selectedRefTable)" class="custom-ng-select me-2">
      <ng-option [value]="">Select...</ng-option>
      <ng-option *ngFor="let setting of referenceTableSettings" [value]="setting.refTable">
        {{ setting.displayName }}
      </ng-option>
    </ng-select>

    <button [disabled]="!selectedRefTable" type="button" class="btn btn-success me-2" (click)="downloadExcel()">
      <fa-icon icon="check"></fa-icon>
      <span>Download</span>
    </button>

    <button [disabled]="!selectedRefTable" type="button" class="btn btn-info me-2" (click)="uploadFile()">
      <fa-icon icon="plus"></fa-icon>
      <span>Upload</span>
    </button>

    <button
      [disabled]="!selectedRefTable"
      id="jh-create-entity"
      data-cy="entityCreateButton"
      class="btn btn-primary jh-create-entity create-working-group-references"
      (click)="viewReferenceRowByRefTable(null, 'create')"
    >
      <fa-icon icon="plus"></fa-icon>
      <span> Create </span>
    </button>
  </div>
  <div class="d-flex justify-content-center">
    <div class="col-11">
      <jhi-filter [columnDefs]="columnDefs" [rowData]="data" [totalItems]="data?.length"></jhi-filter>
    </div>
  </div>
</div>

<div *ngIf="isFromReportBlock">
  <div class="alert alert-warning" *ngIf="data?.length === 0 && type !== 'template'">
    <span>No references found</span>
  </div>

  <div class="table-responsive table-entities">
    <table class="table table-bordered" aria-describedby="page-heading">
      <thead>
        <tr *ngIf="type !== 'template' && !isEdit">
          <ng-container *ngFor="let col of template.columns">
            <th scope="col">
              <span>
                {{ getColumnFormControl(col.index, col.name).value }}
              </span>
            </th>
          </ng-container>
        </tr>

        <tr *ngIf="type === 'template' || isEdit">
          <ng-container *ngFor="let col of settings">
            <th *ngIf="col.type !== 'list'" scope="col">
              <span>
                {{ getColumnFormControl(col.index, col.name).value }}
              </span>
            </th>
            <ng-container *ngFor="let col2 of col?.columns">
              <th *ngIf="col.type === 'list' && col?.embedded" scope="col">
                <span>
                  {{ getColumnFormControl(col2.index, col2.title).value }}
                </span>
              </th>
            </ng-container>
          </ng-container>
        </tr>
        <tr *ngIf="type === 'template' || isEdit">
          <ng-container *ngFor="let col of settings">
            <th scope="col" *ngIf="(isEdit || isActiveColumn(col.index)) && col.type !== 'list'">
              <div class="d-flex">
                <input
                  [id]="'column_' + col.index"
                  [formControl]="getColumnFormControl(col.index, col.name)"
                  class="form-control"
                  *ngIf="type === 'template' || isEdit"
                  (change)="setColumnValue(col.index)"
                />
                <br />
              </div>
              <p class="table-col"></p>
              <input
                *ngIf="type === 'template' || isEdit"
                class="form-check-input"
                type="checkbox"
                [ngModel]="getValueTemplate(col.index)"
                (click)="setValueTemplate(col.index, col.name, '')"
              />
            </th>
            <ng-container *ngFor="let col2 of col?.columns">
              <th scope="col" *ngIf="(isEdit || isActiveColumn(col2.index)) && col.type === 'list' && col?.embedded">
                <div class="d-flex">
                  <input
                    [id]="'column_' + col2.index"
                    [formControl]="getColumnFormControl(col2.index, col2.title)"
                    class="form-control"
                    *ngIf="type === 'template' || isEdit"
                    (change)="setColumnValue(col2.index)"
                  />
                  <br />
                </div>
                <p class="table-col"></p>
                <input
                  *ngIf="type === 'template' || isEdit"
                  class="form-check-input"
                  type="checkbox"
                  [ngModel]="getValueTemplate(col2.index)"
                  (click)="setValueTemplate(col2.index, col2.title, col.index)"
                />
              </th>
            </ng-container>
          </ng-container>
        </tr>
      </thead>
      <tbody *ngIf="type !== 'template' && !isEdit">
        <tr *ngFor="let row of confirmedData; trackBy: trackId" data-cy="entityTable">
          <ng-container *ngFor="let col of template.columns">
            <td *ngIf="isActiveColumn(col.index)">
              {{ getValue(row, col.index) }}
            </td>
          </ng-container>
        </tr>
      </tbody>
    </table>
  </div>
</div>
